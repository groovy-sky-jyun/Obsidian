## PlayerCharacter_BP
#### Components
Capsule Component > Child Actor

---

#### Details
Sphere > Details > Physics > Simulate Physics : true  

---

#### Event Graph
##### Right Mouse Button
- Pressed : Play Anim Montage - 'Is Aiming' (true) - <mark style="background: #ADCCFFA6;">Predict Projectile Path (Advanced)</mark>
- Released : Play Anim Montage - 'Is Aiming' (false) - <mark style="background: #FFB8EBA6;">Spawn Actor Grenade_BP</mark>

##### <mark style="background: #FFB8EBA6;">Spawn Actor Grenade_BP</mark>
- Spawn Transform Location : Get World Location - target : Child Actor(Player Character의 Component)
- Spawn Transform Rotation : Get Actor Rotation - Get Actor Rotation
- Return : Get Sphere -> 변수로 지정 'Grenade Sphere'

> ###### __Socket에 Grenade Actor를 부착할 경우__
> World Location와 World Rotation을 사용하는 것이 좋다. Actor Location/Rotation을 사용하면 플레이어 몸통(중심)에 수류탄이 생성될 수 있다. 회전 또한 캐릭터 전체의 방향이 반영되므로 손의 방향과 캐릭터가 바라보는 방향이 달라 원치 않는 방향으로 던져질 수 있다.
>
>'Get Socket Location/Rotation'은 소켓의 World Locatoin/Rotation을 가져오므로 이를 이용하면 된다.
>```cpp
>FVector SpawnLocation = GetMesh()->GetSocketLocation();
>FRotation SpawnRotation = GetMesh()->GetSocketRotation();
>
>AGrenade* SpawnGrenade = GetWorld()->SpawnActor<AGrenade>(GrenadeClass, SpawnLocation, SpawnRotation);
>```

<br>

##### <mark style="background: #FFB8EBA6;">Set Physics Linear Velocity</mark>
- Target : 'Grenade Sphere'
- New Yal : '<span style="color:rgb(255, 192, 0)">yal</span>'

> ###### __yal은 무슨 값인가?__
> ###### Get Unit Direction (Vector)
> - From : Get Actor Location - target : self
> - To : Get Actor Location - target : 'Grenade Sphere'
> - return : 'Unit Direction'
>
> ###### X
> - Unit Direction
> - Speed
> - return : '<span style="color:rgb(255, 192, 0)">yal</span>'

`Set Physics Linear Velocity()`는 물리 기반 액터의 직선 속도를 설정하는 함수이다. 이 함수로 액터 오브젝트에 방향과 속도를 지정해 힘을 설정할 수 있다.
이를 사용하기 위해서는 액터의 물리 시물레이션이 활성화 되어 있어야 한다.
-> `Set Simulate Physics(true)`
```cpp
UPrimitiveComponent* GrenadePhysics = SpawnGrenade->FindComponentByClass<UPrimitiveComponent>();

if(GrenadePhysics)
{
	FVector ThrowDirection = GetActorForwardVector() * 1500.f + FVector(0, 0, 300.f);

	GrenadePhysics->SetPhysicsLinearVelocity(ThrowDirection);
}
```

>__UPrimitiveComponent__
>- SpawnGrenade에 속해있는 StaticMesh를 반환한다.
>- 컴포넌트 상속 관계는 다음과 같다.
>- UActorComponent
>	- USceneComponent
>		- UPrimitiveComponent
>			- UStaticMeshComponent
>			- USkeletalMeshComponent
>			- UCapsuleComponent
>			- USphereComponent
>
>이를 바탕으로 보면 
>- #UPrimitiveComponent 는 #USceneComponent 의 자손으로 Geometry 표현이 있는 Scene Component이다. 
>- (Scene Component는 Geometry 표현이 필요하지 않은 위치 기반 동작을 지원한다.)
>- 주로 렌더링, 충돌, 오버랩에 사용된다. 
>- Box, Capsule, Collision, Volume, Static Mesh, Skeletal Mesh, Particle System등을 나타낸다. 
>- `FindComponentByClass<UPrimitiveComponent>()`를 통해 SpawnGrenade 액터 내부에 있는 물리, 충돌, 렌더링을 담당하는 UPrimitiveComponent를 가져올 수 있다.
>- 보통 UStaticMeshComponent

##### <mark style="background: #ADCCFFA6;">Predict Projectile Path (Advanced)</mark>
- Predict Params Start Location : Get World Location - target : 'Child Actor' (플레이어 component)
- Predict Params Draw Debug Type : Persistant (후에 none 으로 변경)
- Predict Params Sim Frequency : 100.0f
- Predict Params Max Sim Time : 3.0f
- Predict Params Launch Velocity : 'Velocity'
- return : Predict Result Path Data - 'Predict Path Data'

> ###### Get Unit Direction (Vector)
>  - From : Get Actor Location - target : self
>  - To : Get World Location - target : 'Child Actor' (플레이어의 Component)
>  - return : 'Projectile Direction'
>
> ###### X
> - Speed
> - 'Projectile Direction'
> - return : 'Velocity'

##### <mark style="background: #ADCCFFA6;">For Each Loop</mark>
- Array : 'Predict Path Data'
- return : Element Location (Array Element Split) -> 'Trajectory Location'
- Completed - Delay - Branch

##### <mark style="background: #ADCCFFA6;">Spawn Actor "TrajectoryLine_BP"</mark>
- Spawn Transform Location : 'Trajectory Location'

##### <mark style="background: #ADCCFFA6;">Delay</mark>

##### <mark style="background: #ADCCFFA6;">Branch</mark>
- Condition : 'IsAiming'?
- True : 위의 Predict Projectile Path의 시작에 연결 (Predict Params Draw Debug Type : none) 
- False : x
